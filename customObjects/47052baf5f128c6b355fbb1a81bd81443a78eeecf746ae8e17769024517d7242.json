{"name@lisperanto":"define_filteredSearch","type@lisperanto":"function","module@lisperanto":"lisperanto","programming-language@lisperanto":"javascript","javascript-function-definition@lisperanto":"() => {\r\n\r\n    lisperanto.filteredSearch = ko.computed(\r\n\r\n        function()\r\n\r\n        {\r\n\r\n            var changeOccured = lisperanto.somethingChanged();\r\n\r\n            var searchQuery = lisperanto.omniBoxTextInput().trim().toLowerCase();\r\n\r\n            var filtered = [];\r\n\r\n            const availableKeys = Object.keys(lisperanto.customObjects);\r\n\r\n    \r\n\r\n            const non_statements = ko.utils.arrayFilter(availableKeys, function(key)\r\n\r\n                {\r\n\r\n\r\n                    const has_new_version = key in lisperanto.has_new_version_map;\r\n\r\n                    if(has_new_version)\r\n                        return false;\r\n\r\n                    const obj = lisperanto.customObjects[key];\r\n                    var name = \"\";\r\n                    if(\"name@lisperanto\" in obj)\r\n                    {\r\n                        name = obj[\"name@lisperanto\"];\r\n\r\n                    }\r\n\r\n                    if(name in lisperanto[\"lookup_by_name\"])\r\n                    {\r\n                        // so last time I decided that I need comments\n\n                        // this is for case when I have manual edits from regular editor\n                        var latest_operation_key = lisperanto[\"lookup_by_name\"][name];\r\n                        var operation = lisperanto.operations[latest_operation_key];\r\n                        if (operation.id_to != key)\r\n                            return false;\r\n                    }\r\n\r\n                    \r\n                    return true;\r\n\r\n                });\r\n\r\n    \r\n\r\n            const mapped = ko.utils.arrayMap(non_statements, function(key) {\r\n\r\n                const obj = lisperanto.customObjects[key];\r\n\r\n                var name = \"\";\r\n\r\n                if(\"name@lisperanto\" in obj)\r\n\r\n                {\r\n\r\n                    name = obj[\"name@lisperanto\"];\r\n\r\n                }\r\n\r\n    \r\n\r\n                if( \"name\" in obj )\r\n\r\n                {\r\n\r\n                    name = obj[\"name\"]\r\n\r\n                }\r\n\r\n    \r\n\r\n                if(name === \"\")\r\n\r\n                {\r\n\r\n                    name = \"no-name \" + obj.id;\r\n\r\n                }\r\n\r\n                \r\n\r\n                var toReturn = {\r\n\r\n                    id: key,\r\n\r\n                    text: name,\r\n\r\n                    full_text: JSON.stringify(obj).toLowerCase()\r\n\r\n                };\r\n\r\n    \r\n\r\n                toReturn[\"search_index_text\"] = toReturn.text.toLowerCase().indexOf(searchQuery);\r\n\r\n                toReturn[\"search_index_full_text\"] = toReturn.full_text.indexOf(searchQuery);\r\n\r\n                return toReturn;\r\n\r\n                \r\n\r\n            });\r\n\r\n    \r\n\r\n            if(searchQuery === \"\")\r\n\r\n            {\r\n\r\n                filtered = mapped;\r\n\r\n            }\r\n\r\n            else\r\n\r\n            {\r\n\r\n                filtered = ko.utils.arrayFilter(mapped, function(item)\r\n\r\n                {\r\n\r\n                    return item[\"search_index_text\"] >= 0 || item[\"search_index_full_text\"]  >= 0;\r\n\r\n                });\r\n\r\n            }\r\n\r\n    \r\n\r\n            filtered = filtered.map(element => {\r\n\r\n                const index = element[\"search_index_full_text\"];\r\n\r\n                if (searchQuery !== \"\" && element[\"search_index_text\"] < 0 &&  index >= 0)\r\n\r\n                {\r\n\r\n                    const new_text = element.full_text.substring(index - 5, index + searchQuery.length + 5);\r\n\r\n                    element.text = element.text + \"  ...\" + new_text;\r\n\r\n                }\r\n\r\n                return element;\r\n\r\n            });\r\n\r\n    \r\n\r\n            return filtered;\r\n\r\n        }\r\n\r\n    );\r\n\r\n}"}