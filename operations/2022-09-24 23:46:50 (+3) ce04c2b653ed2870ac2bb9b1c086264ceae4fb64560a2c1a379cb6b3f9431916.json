{"operation":"create-initial-version","id_to":"2f03816a9add68d814fa2e94ded5ef03c354400a50a7e420cae4d7960e339d70","initial-data":{"name@lisperanto":"migrate_all_function_to_storage_async","type@lisperanto":"function","module@lisperanto":"lisperanto","programming-language@lisperanto":"javascript","previous-version@lisperanto":"6240e6fb06c0ddac63c2c4baeeaea38826498c43146f1874052769c5185a0e8c","javascript-function-definition@lisperanto":"async function()\r\n{\r\n    for(var key_name in lisperanto)\r\n    {\r\n        if (key_name == \"customObjects\")\r\n        {\r\n            // ignore customObjects\r\n            continue;\r\n        }\r\n        const rdf_entry_name = key_name;\r\n        const entry_in_lisperanto = lisperanto[key_name];\r\n        const type_of_entry = typeof(entry_in_lisperanto);\r\n        var expected_object = {};\r\n        expected_object[\"name@lisperanto\"] = rdf_entry_name;\r\n        expected_object[\"type@lisperanto\"] = type_of_entry;\r\n        expected_object[\"module@lisperanto\"] = \"lisperanto\";\r\n\r\n        if(type_of_entry === \"function\")\r\n        {\r\n            const function_definition = entry_in_lisperanto.toString();\r\n            if(function_definition.toLowerCase().indexOf(\"[object\") == 0 )\r\n            {\r\n                continue;\r\n            }\r\n            expected_object[\"programming-language@lisperanto\"] = \"javascript\";\r\n\r\n            const headers_only = lisperanto.clone(expected_object);\r\n            const initial_hash = await lisperanto.calculate_hash_promise(headers_only);\r\n            if (!(initial_hash in lisperanto.customObjects))\r\n            {\r\n                await lisperanto.create_object_with_hash_async(headers_only);\r\n            }\r\n            const latest_version_hash = lisperanto.find_latest_version(initial_hash);\r\n            const latest_object = lisperanto.customObjects[latest_version_hash];\r\n            if( \"previous-version@lisperanto\" in latest_object)\r\n            {\r\n                expected_object[\"previous-version@lisperanto\"] = latest_object[\"previous-version@lisperanto\"];\r\n            }\r\n            else\r\n            {\r\n                expected_object[\"previous-version@lisperanto\"] = latest_version_hash;\r\n            }\r\n\r\n            expected_object[\"javascript-function-definition@lisperanto\"] = function_definition;\r\n            const present = await lisperanto.equal_exists_async(expected_object);\r\n\r\n            if (!present)\r\n            {\r\n                await lisperanto.create_object_with_hash_async(expected_object);\r\n                console.log(\"creating json entry for\", expected_object);\r\n            }\r\n        }\r\n        else\r\n        {\r\n            console.log(\"Non function found\")\r\n            console.log(key_name);\r\n        }\r\n    }\r\n}"},"time":"2022-09-24 23:46:50 (+3)"}