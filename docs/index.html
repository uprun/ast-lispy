
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lisperanto</title>
    <link rel="stylesheet" href="css/site.css" />
    <link rel="icon" href="favicon.ico" type="image/x-icon"/>
</head>
<body data-bind="click: $root.hideOmniBox">
    <script type="text/html" id="function-definition-template">
        <div>
            <span style="font-size: 1rem;" class="my-function" data-bind="text: type"></span>
            <span data-bind="if: name !== ''">
                <span class="my-function-name" style="font-size: 1.5rem;" data-bind="text: name"></span>
            </span>
            <button style="margin-left: 2rem;" data-bind="click: $root.activateRenameFunctionTool">rename</button>
            <div>
                parameters:
            </div>
            <div style="margin-left: 2rem;" data-bind="template: { name: 'parameter-symbol-template', foreach: parameters }">
            </div>
            <span data-bind="if: type !== 'built-in-function', attr: {id: 'body--' + $data.id}">
                <button style="margin-left: 2rem;" data-bind="click: $root.activateAddingParameterTool">add</button>
                <span data-bind="if: parameters().length == 0">
                    <button style="margin-left: 2rem;" data-bind="click: $root.startEvaluation">evaluate</button>
                    <span data-bind="text: evaluationResult"></span>
                </span>
                <span data-bind="ifnot: parameters().length == 0">
                    <span>to evaluate this function create another function with zero arguments and call this one from there</span>
                </span>
                
                <div>
                    body:
                </div>
                <div style="margin-left: 2rem;" data-bind="template: { name: 'body-element-template', foreach: body }">
                </div>
                <button style="margin-left: 2rem;" data-bind="click: $root.focusOnBody">focus</button>
            </span>
        </div>
        <br>
        <div class="text-center" data-bind="if: $root.activeOperation() === 'focusOnBody' || $root.activeOperation() === 'focusOnParameter'">
            <input data-bind="value: $root.constantIntValue" />
            <button data-bind="click: $root.addConstant">add constant</button>
        </div>
        <br>

        <div class="text-center" data-bind="if: $root.activeOperation() === 'focusOnBody' || $root.activeOperation() === 'focusOnParameter'">
            <input data-bind="value: $root.symbolToAdd" />
            <button data-bind="click: $root.addSymbol">add symbol</button>
        </div>
        <br>
        <div class="text-center" data-bind="if: $root.activeOperation() === 'focusOnBody' || $root.activeOperation() === 'focusOnParameter'">
            <select data-bind="options: $root.functionsLookup,
                        optionsText: 'text',
                        value: $root.functionToAdd,
                        optionsCaption: 'Choose function'"></select>
            <button data-bind="click: $root.addFunction">call</button>
        </div>
        <br>
        <div class="text-center" data-bind="if: $root.activeOperation() === 'activateRenameFunctionTool'">
            <input data-bind="value: $root.newFunctionName" /></p>
            <button data-bind="click: $root.renameFunction">rename function</button>
        </div>
        <br>
        <div class="text-center" data-bind="if: $root.activeOperation() === 'activateAddingParameterTool'">
            <input data-bind="value: $root.newParameterName" /></p>
            <button data-bind="click: $root.addParameter">add parameter</button>
        </div>
    </script>
    <script type="text/html" id="parameter-value-template">
        <div>
            <div data-bind="template: { name: 'body-element-template', data: lookup.customObjects[$data].guidToUse() }" >
            </div>
            <span data-bind='if: typeof(lookup.customObjects[$data].guidToUse()) === "undefined" '>
                <span data-bind="text: lookup.customObjects[lookup.customObjects[$data].parameterGuid].parameterName + ':' "></span>
                <button data-bind="click: $root.focusOnParameter">focus</button>
            <span>
        </div>
    </script>
    <script type="text/html" id="parameter-symbol-template">
        <div>
            <strong data-bind="text: lookup.customObjects[$data].parameterName"></strong>
        </div>
    </script>
    <script type="text/html" id="constant-int-template">
        <strong data-bind="text: value"></strong>
    </script>
    <script type="text/html" id="symbol-usage-template">
        <strong data-bind="text: symbolName"></strong>
    </script>
    <script type="text/html" id="function-usage-template">
        <span data-bind="text: '('"></span>
        <strong 
            class="my-function-name" 
            data-bind="
                text: lookup.customObjects[$data.functionGuid].name(), 
                click: $root.openOmniBoxForFunctionUsage, 
                attr: {id: $data.id}"
            >
        </strong>
        <span class="my-function-result" data-bind="text: '// result: ' + evaluationResult() "></span>
        <div style="margin-left: 2rem;" data-bind="template: { name: 'parameter-value-template', foreach: parameters }" >
        </div>
        <span data-bind="text: ')'"></span>
    </script>
    <script type="text/html" id="body-element-template">
        <div>
            <span data-bind="if:typeof($data) !== 'undefined' ">
                <span data-bind='if: lookup.customObjects[$data].type === "constant-int" '>
                    <div data-bind="template: { name: 'constant-int-template', data: lookup.customObjects[$data] }"></div>
                </span>
                <span data-bind='if: lookup.customObjects[$data].type === "function-usage" '>
                    <div data-bind="template: { name: 'function-usage-template', data: lookup.customObjects[$data] }"></div>
                </span>
                <span data-bind='if: lookup.customObjects[$data].type === "symbol-usage" '>
                    <div data-bind="template: { name: 'symbol-usage-template', data: lookup.customObjects[$data] }"></div>
                </span>
                
            </span>
            
        </div>
    </script>
    <div class="text-center">
        <button data-bind="click: $root.createFunction">create function </button>
        <button data-bind="click: $root.openListOfFunctions">open list of functions </button>
        <button onclick="lookup.removeEverything()">Reset</button>

    </div>
    <div data-bind="if: $root.listOfFunctionsIsActive()">
        <div class="text-left" data-bind="foreach: functionsArray">
            <div  >
                <span data-bind="if: name !== ''">
                    <span class="my-function-name" style="font-size: 1.5rem;" data-bind="text: name(), click: $root.openOmniBoxForFunction, attr: {id: $data.id}"></span>
                    <span style="font-size: 1.5rem;" data-bind="text: '('+ parameters().map(x => lookup.customObjects[x].parameterName).join(', ') + ')'"></span>
                </span>
            </div>
        </div>
    </div>
    
    <div data-bind="if: $root.functionDefinitionIsActive() ">
        <div data-bind="template: { name: 'function-definition-template', data: $root.activeFunction() }"></div>


    </div>

    <div class="contextual-omni-box" data-bind="visible: $root.omniBoxVisible, click: $root.omniBoxClick">
        <div data-bind="if: $root.activeOperation() === 'focusOnBody' || $root.activeOperation() === 'focusOnParameter'">
            <input data-bind="value: $root.omniBoxTextInput" />
            
        </div>
        <div data-bind="foreach: $root.functionsLookup">
            <div data-bind="text: $data.text"></div>

        </div>
        <div data-bind="if: typeof($root.omniBoxSelectedFunction()) !== 'undefined' ">
            <span data-bind="click: $root.omniBoxOpenFunctionAction">
                Go to definition
            </span>
        </div>
    </div>
    
    <script src="lib/jquery/dist/jquery.min.js"></script>
    <script src="lib/knockoutjs/3.5.1/Content/Scripts/knockout-3.5.1.js" asp-append-version="true"></script>
    <script src="js/lisperanto.js" asp-append-version="true"></script>
    <script src="js/removeEverything.js" asp-append-version="true"></script>
</body>
</html>
